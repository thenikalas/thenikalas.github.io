#!/bin/bash

# Cloudflare WARP Endpoint & Port Finder (Advanced, 2-Stage, Wide Port Scan, Progress Bar)
# Stage 1: Find the 6 best (lowest latency) endpoints from all major Cloudflare WARP IPv4 ranges.
# Stage 2: For each of the top 6 IPs, scan a wide range of well-known and commonly open ports to find the best open port with the lowest ping.
# Output: The best endpoints and their optimal open ports for WARP usage.

# --------------------------- CONFIGURATION -------------------------------

ranges=(
"103.22.202"
"103.22.203"
"103.22.200"
"103.22.201"
"104.29.0"
"104.29.1"
"104.29.2"
"104.29.3"
"104.29.4"
"104.29.5"
"104.29.6"
"104.29.7"
"104.29.8"
"104.29.9"
"104.29.10"
"104.29.11"
"104.29.12"
"104.29.13"
"104.29.14"
"104.29.15"
"104.29.16"
"104.29.17"
"104.29.18"
"104.29.19"
"104.29.20"
"104.29.21"
"104.29.22"
"104.29.23"
"104.29.24"
"104.29.25"
"104.29.26"
"104.29.27"
"104.29.28"
"104.29.29"
"104.29.30"
"104.29.31"
"104.29.32"
"104.29.33"
"104.29.34"
"104.29.35"
"104.29.36"
"104.29.37"
"104.29.38"
"104.29.39"
"104.29.40"
"104.29.41"
"104.29.42"
"104.29.43"
"104.29.44"
"104.29.45"
"104.29.46"
"104.29.47"
"104.29.48"
"104.29.49"
"104.29.50"
"104.29.52"
"104.29.53"
"104.29.54"
"104.29.55"
"104.29.57"
"104.29.58"
"104.29.59"
"104.29.60"
"104.29.61"
"104.29.62"
"104.29.63"
"104.29.64"
"104.29.65"
"104.29.66"
"104.29.67"
"104.29.68"
"104.29.69"
"104.29.70"
"104.29.71"
"104.29.72"
"104.29.73"
"104.29.74"
"104.29.75"
"104.29.76"
"104.29.77"
"104.29.78"
"104.29.79"
"104.29.80"
"104.29.81"
"104.29.82"
"104.29.83"
"104.29.84"
"104.29.85"
"104.29.86"
"104.29.87"
"104.29.88"
"104.29.89"
"104.29.90"
"104.29.91"
"104.29.92"
"104.29.93"
"104.29.94"
"104.29.95"
"104.29.96"
"104.29.97"
"104.29.98"
"104.29.99"
"104.29.100"
"104.29.101"
"104.29.102"
"104.29.104"
"104.29.105"
"104.29.106"
"104.29.107"
"104.29.108"
"104.29.109"
"104.29.110"
"104.29.112"
"104.29.113"
"104.29.114"
"104.29.115"
"104.29.116"
"104.29.117"
"104.29.121"
"104.29.122"
"104.29.123"
"104.30.132"
"104.30.133"
"104.30.134"
"104.30.135"
"104.28.9"
"104.28.10"
"104.28.11"
"104.28.12"
"104.28.13"
"104.28.14"
"104.28.15"
"104.28.28"
"104.28.29"
"104.28.30"
"104.28.31"
"104.28.32"
"104.28.33"
"104.28.34"
"104.28.35"
"104.28.37"
"104.28.38"
"104.28.39"
"104.28.40"
"104.28.42"
"104.28.43"
"104.28.44"
"104.28.45"
"104.28.46"
"104.28.47"
"104.28.48"
"104.28.49"
"104.28.50"
"104.28.51"
"104.28.52"
"104.28.53"
"104.28.54"
"104.28.55"
"104.28.56"
"104.28.57"
"104.28.58"
"104.28.59"
"104.28.60"
"104.28.61"
"104.28.62"
"104.28.63"
"104.28.64"
"104.28.65"
"104.28.66"
"104.28.67"
"104.28.69"
"104.28.70"
"104.28.72"
"104.28.80"
"104.28.81"
"104.28.82"
"104.28.83"
"104.28.85"
"104.28.86"
"104.28.87"
"104.28.88"
"104.28.89"
"104.28.90"
"104.28.91"
"104.28.93"
"104.28.95"
"104.28.96"
"104.28.97"
"104.28.98"
"104.28.99"
"104.28.100"
"104.28.101"
"104.28.102"
"104.28.103"
"104.28.104"
"104.28.105"
"104.28.106"
"104.28.107"
"104.28.108"
"104.28.110"
"104.28.111"
"104.28.112"
"104.28.113"
"104.28.114"
"104.28.115"
"104.28.116"
"104.28.117"
"104.28.118"
"104.28.119"
"104.28.120"
"104.28.121"
"104.28.122"
"104.28.123"
"104.28.124"
"104.28.125"
"104.28.127"
"104.28.129"
"104.28.130"
"104.28.131"
"104.28.132"
"104.28.133"
"104.28.134"
"104.28.135"
"104.31.18"
"108.162.209"
"108.162.210"
"108.162.211"
"108.162.212"
"108.162.213"
"108.162.216"
"108.162.217"
"108.162.218"
"108.162.220"
"108.162.221"
"108.162.226"
"108.162.227"
"108.162.235"
"108.162.236"
"108.162.237"
"108.162.238"
"108.162.239"
"108.162.240"
"108.162.241"
"108.162.242"
"108.162.243"
"108.162.244"
"108.162.245"
"108.162.246"
"108.162.247"
"108.162.248"
"108.162.249"
"108.162.250"
"141.101.64"
"141.101.65"
"141.101.66"
"141.101.67"
"141.101.68"
"141.101.69"
"141.101.70"
"141.101.71"
"141.101.72"
"141.101.73"
"141.101.74"
"141.101.75"
"141.101.82"
"141.101.83"
"141.101.84"
"141.101.85"
"141.101.86"
"141.101.87"
"141.101.93"
"141.101.94"
"141.101.95"
"141.101.96"
"141.101.97"
"141.101.98"
"141.101.99"
"141.101.104"
"141.101.105"
"141.101.108"
"141.101.109"
"141.101.110"
"141.101.76"
"141.101.77"
"141.101.100"
"162.158.8"
"162.158.9"
"162.158.10"
"162.158.11"
"162.158.26"
"162.158.27"
"162.158.28"
"162.158.29"
"162.158.30"
"162.158.31"
"162.158.36"
"162.158.37"
"162.158.38"
"162.158.40"
"162.158.41"
"162.158.42"
"162.158.43"
"162.158.100"
"162.158.101"
"162.158.102"
"162.158.103"
"162.158.105"
"162.158.106"
"162.158.107"
"162.158.112"
"162.158.113"
"162.158.114"
"162.158.115"
"162.158.120"
"162.158.121"
"162.158.122"
"162.158.192"
"162.158.193"
"162.158.194"
"162.158.195"
"162.158.196"
"162.158.197"
"162.158.198"
"162.158.199"
"162.158.0"
"162.158.1"
"162.158.2"
"162.158.3"
"162.158.6"
"162.158.7"
"162.158.12"
"162.158.13"
"162.158.14"
"162.158.15"
"162.158.16"
"162.158.17"
"162.158.18"
"162.158.19"
"162.158.20"
"162.158.21"
"162.158.22"
"162.158.23"
"162.158.24"
"162.158.25"
"162.158.32"
"162.158.33"
"162.158.34"
"162.158.35"
"162.158.44"
"162.158.45"
"162.158.46"
"162.158.47"
"162.158.49"
"162.158.50"
"162.158.51"
"162.158.52"
"162.158.53"
"162.158.54"
"162.158.55"
"162.158.56"
"162.158.57"
"162.158.58"
"162.158.59"
"162.158.60"
"162.158.61"
"162.158.62"
"162.158.63"
"162.158.72"
"162.158.73"
"162.158.74"
"162.158.75"
"162.158.76"
"162.158.77"
"162.158.78"
"162.158.79"
"162.158.80"
"162.158.81"
"162.158.82"
"162.158.83"
"162.158.84"
"162.158.85"
"162.158.86"
"162.158.87"
"162.158.88"
"162.158.89"
"162.158.90"
"162.158.91"
"162.158.92"
"162.158.93"
"162.158.94"
"162.158.95"
"162.158.96"
"162.158.97"
"162.158.98"
"162.158.99"
"162.158.109"
"162.158.110"
"162.158.111"
"162.158.117"
"162.158.118"
"162.158.119"
"162.158.124"
"162.158.125"
"162.158.126"
"162.158.127"
"162.158.128"
"162.158.129"
"162.158.130"
"162.158.131"
"162.158.132"
"162.158.133"
"162.158.134"
"162.158.135"
"162.158.136"
"162.158.137"
"162.158.138"
"162.158.139"
"162.158.140"
"162.158.141"
"162.158.142"
"162.158.143"
"162.158.144"
"162.158.145"
"162.158.146"
"162.158.147"
"162.158.148"
"162.158.149"
"162.158.150"
"162.158.151"
"162.158.153"
"162.158.154"
"162.158.155"
"162.158.157"
"162.158.158"
"162.158.159"
"162.158.160"
"162.158.161"
"162.158.162"
"162.158.163"
"162.158.164"
"162.158.165"
"162.158.166"
"162.158.167"
"162.158.169"
"162.158.170"
"162.158.171"
"162.158.172"
"162.158.173"
"162.158.174"
"162.158.175"
"162.158.176"
"162.158.177"
"162.158.178"
"162.158.179"
"162.158.180"
"162.158.181"
"162.158.182"
"162.158.183"
"162.158.185"
"162.158.186"
"162.158.187"
"162.158.188"
"162.158.189"
"162.158.190"
"162.158.191"
"162.158.200"
"162.158.201"
"162.158.202"
"162.158.203"
"162.158.204"
"162.158.205"
"162.158.206"
"162.158.207"
"162.158.208"
"162.158.209"
"162.158.210"
"162.158.211"
"162.158.212"
"162.158.213"
"162.158.214"
"162.158.215"
"162.158.216"
"162.158.217"
"162.158.218"
"162.158.219"
"162.158.220"
"162.158.221"
"162.158.222"
"162.158.223"
"162.158.224"
"162.158.225"
"162.158.226"
"162.158.227"
"162.158.228"
"162.158.229"
"162.158.230"
"162.158.231"
"162.158.232"
"162.158.233"
"162.158.234"
"162.158.235"
"162.158.236"
"162.158.237"
"162.158.238"
"162.158.239"
"162.158.240"
"162.158.241"
"162.158.242"
"162.158.243"
"162.158.246"
"162.158.247"
"162.158.244"
"162.158.248"
"162.158.249"
"162.158.250"
"162.158.251"
"162.158.252"
"162.158.253"
"162.158.254"
"162.158.255"
"162.159.79"
"172.64.76"
"172.64.176"
"172.64.177"
"172.64.182"
"172.64.183"
"172.64.236"
"172.64.237"
"172.64.238"
"172.64.239"
"172.68.57"
"172.68.58"
"172.68.59"
"172.68.0"
"172.68.1"
"172.68.2"
"172.68.3"
"172.68.4"
"172.68.5"
"172.68.6"
"172.68.8"
"172.68.9"
"172.68.10"
"172.68.11"
"172.68.13"
"172.68.14"
"172.68.15"
"172.68.30"
"172.68.31"
"172.68.16"
"172.68.17"
"172.68.18"
"172.68.19"
"172.68.21"
"172.68.22"
"172.68.23"
"172.68.25"
"172.68.26"
"172.68.27"
"172.68.28"
"172.68.29"
"172.68.32"
"172.68.33"
"172.68.34"
"172.68.35"
"172.68.36"
"172.68.37"
"172.68.38"
"172.68.39"
"172.68.40"
"172.68.42"
"172.68.43"
"172.68.44"
"172.68.45"
"172.68.46"
"172.68.47"
"172.68.48"
"172.68.49"
"172.68.50"
"172.68.51"
"172.68.52"
"172.68.53"
"172.68.54"
"172.68.55"
"172.68.60"
"172.68.61"
"172.68.62"
"172.68.63"
"172.68.64"
"172.68.65"
"172.68.66"
"172.68.67"
"172.68.68"
"172.68.69"
"172.68.70"
"172.68.71"
"172.68.74"
"172.68.75"
"172.68.72"
"172.68.73"
"172.68.76"
"172.68.77"
"172.68.78"
"172.68.79"
"172.68.80"
"172.68.81"
"172.68.82"
"172.68.83"
"172.68.84"
"172.68.85"
"172.68.86"
"172.68.87"
"172.68.88"
"172.68.89"
"172.68.90"
"172.68.91"
"172.68.92"
"172.68.93"
"172.68.94"
"172.68.95"
"172.68.96"
"172.68.97"
"172.68.98"
"172.68.99"
"172.68.100"
"172.68.101"
"172.68.102"
"172.68.103"
"172.68.104"
"172.68.105"
"172.68.106"
"172.68.107"
"172.68.108"
"172.68.109"
"172.68.110"
"172.68.111"
"172.68.112"
"172.68.113"
"172.68.114"
"172.68.115"
"172.68.116"
"172.68.117"
"172.68.118"
"172.68.119"
"172.68.123"
"172.68.120"
"172.68.126"
"172.68.127"
"172.68.124"
"172.68.125"
"172.68.128"
"172.68.129"
"172.68.130"
"172.68.131"
"172.68.132"
"172.68.133"
"172.68.134"
"172.68.135"
"172.68.139"
"172.68.140"
"172.68.141"
"172.68.142"
"172.68.143"
"172.68.144"
"172.68.145"
"172.68.146"
"172.68.147"
"172.68.148"
"172.68.149"
"172.68.150"
"172.68.151"
"172.68.152"
"172.68.153"
"172.68.154"
"172.68.155"
"172.68.156"
"172.68.157"
"172.68.159"
"172.68.160"
"172.68.161"
"172.68.162"
"172.68.163"
"172.68.164"
"172.68.165"
"172.68.166"
"172.68.167"
"172.68.168"
"172.68.169"
"172.68.170"
"172.68.171"
"172.68.172"
"172.68.173"
"172.68.174"
"172.68.175"
"172.68.176"
"172.68.177"
"172.68.178"
"172.68.179"
"172.68.180"
"172.68.181"
"172.68.182"
"172.68.183"
"172.68.184"
"172.68.185"
"172.68.186"
"172.68.187"
"172.68.188"
"172.68.189"
"172.68.190"
"172.68.191"
"172.68.192"
"172.68.193"
"172.68.194"
"172.68.195"
"172.68.196"
"172.68.197"
"172.68.198"
"172.68.199"
"172.68.200"
"172.68.201"
"172.68.202"
"172.68.203"
"172.68.204"
"172.68.205"
"172.68.206"
"172.68.207"
"172.68.208"
"172.68.209"
"172.68.210"
"172.68.211"
"172.68.212"
"172.68.213"
"172.68.214"
"172.68.215"
"172.68.216"
"172.68.217"
"172.68.218"
"172.68.219"
"172.68.222"
"172.68.223"
"172.68.220"
"172.68.221"
"172.68.224"
"172.68.225"
"172.68.226"
"172.68.227"
"172.68.230"
"172.68.231"
"172.68.228"
"172.68.229"
"172.68.232"
"172.68.233"
"172.68.236"
"172.68.237"
"172.68.238"
"172.68.239"
"172.68.240"
"172.68.241"
"172.68.242"
"172.68.243"
"172.68.244"
"172.68.245"
"172.68.246"
"172.68.247"
"172.68.248"
"172.68.249"
"172.68.250"
"172.68.251"
"172.68.252"
"172.68.253"
"172.68.254"
"172.68.255"
"172.69.32"
"172.69.33"
"172.69.34"
"172.69.35"
"172.69.2"
"172.69.3"
"172.69.0"
"172.69.4"
"172.69.5"
"172.69.6"
"172.69.7"
"172.69.8"
"172.69.9"
"172.69.10"
"172.69.11"
"172.69.12"
"172.69.13"
"172.69.14"
"172.69.15"
"172.69.16"
"172.69.17"
"172.69.18"
"172.69.19"
"172.69.20"
"172.69.21"
"172.69.22"
"172.69.23"
"172.69.36"
"172.69.37"
"172.69.38"
"172.69.39"
"172.69.40"
"172.69.41"
"172.69.42"
"172.69.43"
"172.69.44"
"172.69.45"
"172.69.46"
"172.69.47"
"172.69.48"
"172.69.49"
"172.69.50"
"172.69.51"
"172.69.52"
"172.69.53"
"172.69.54"
"172.69.55"
"172.69.56"
"172.69.57"
"172.69.58"
"172.69.59"
"172.69.60"
"172.69.61"
"172.69.62"
"172.69.63"
"172.69.64"
"172.69.65"
"172.69.66"
"172.69.67"
"172.69.68"
"172.69.69"
"172.69.70"
"172.69.71"
"172.69.72"
"172.69.73"
"172.69.74"
"172.69.75"
"172.69.78"
"172.69.79"
"172.69.76"
"172.69.77"
"172.69.80"
"172.69.81"
"172.69.82"
"172.69.83"
"172.69.84"
"172.69.85"
"172.69.86"
"172.69.87"
"172.69.88"
"172.69.89"
"172.69.90"
"172.69.91"
"172.69.92"
"172.69.93"
"172.69.94"
"172.69.95"
"172.69.96"
"172.69.97"
"172.69.98"
"172.69.99"
"172.69.100"
"172.69.101"
"172.69.102"
"172.69.103"
"172.69.104"
"172.69.105"
"172.69.106"
"172.69.107"
"172.69.110"
"172.69.111"
"172.69.108"
"172.69.109"
"172.69.112"
"172.69.114"
"172.69.115"
"172.69.116"
"172.69.117"
"172.69.118"
"172.69.119"
"172.69.120"
"172.69.121"
"172.69.122"
"172.69.123"
"172.69.124"
"172.69.125"
"172.69.126"
"172.69.127"
"172.69.128"
"172.69.129"
"172.69.130"
"172.69.131"
"172.69.132"
"172.69.133"
"172.69.134"
"172.69.135"
"172.69.136"
"172.69.137"
"172.69.138"
"172.69.139"
"172.69.140"
"172.69.141"
"172.69.142"
"172.69.144"
"172.69.145"
"172.69.146"
"172.69.147"
"172.69.149"
"172.69.150"
"172.69.151"
"172.69.152"
"172.69.153"
"172.69.154"
"172.69.155"
"172.69.156"
"172.69.157"
"172.69.158"
"172.69.159"
"172.69.160"
"172.69.161"
"172.69.162"
"172.69.163"
"172.69.164"
"172.69.165"
"172.69.166"
"172.69.167"
"172.69.168"
"172.69.169"
"172.69.170"
"172.69.171"
"172.69.172"
"172.69.173"
"172.69.174"
"172.69.175"
"172.69.176"
"172.69.177"
"172.69.178"
"172.69.179"
"172.69.180"
"172.69.181"
"172.69.182"
"172.69.183"
"172.69.184"
"172.69.185"
"172.69.187"
"172.69.188"
"172.69.189"
"172.69.190"
"172.69.191"
"172.69.192"
"172.69.193"
"172.69.194"
"172.69.195"
"172.69.196"
"172.69.197"
"172.69.198"
"172.69.199"
"172.69.200"
"172.69.201"
"172.69.202"
"172.69.203"
"172.69.204"
"172.69.205"
"172.69.206"
"172.69.207"
"172.69.208"
"172.69.209"
"172.69.210"
"172.69.211"
"172.69.212"
"172.69.213"
"172.69.214"
"172.69.215"
"172.69.216"
"172.69.217"
"172.69.218"
"172.69.219"
"172.69.220"
"172.69.221"
"172.69.222"
"172.69.223"
"172.69.224"
"172.69.225"
"172.69.226"
"172.69.227"
"172.69.228"
"172.69.229"
"172.69.230"
"172.69.231"
"172.69.234"
"172.69.235"
"172.69.232"
"172.69.236"
"172.69.237"
"172.69.238"
"172.69.239"
"172.69.240"
"172.69.241"
"172.69.242"
"172.69.243"
"172.69.244"
"172.69.245"
"172.69.246"
"172.69.247"
"172.69.248"
"172.69.249"
"172.69.250"
"172.69.251"
"172.69.252"
"172.69.253"
"172.69.254"
"172.70.32"
"172.70.33"
"172.70.34"
"172.70.35"
"172.70.36"
"172.70.37"
"172.70.38"
"172.70.39"
"172.70.40"
"172.70.41"
"172.70.42"
"172.70.43"
"172.70.45"
"172.70.46"
"172.70.47"
"172.70.48"
"172.70.50"
"172.70.51"
"172.70.52"
"172.70.53"
"172.70.54"
"172.70.55"
"172.70.56"
"172.70.57"
"172.70.58"
"172.70.59"
"172.70.61"
"172.70.62"
"172.70.63"
"172.70.64"
"172.70.65"
"172.70.66"
"172.70.67"
"172.70.68"
"172.70.69"
"172.70.70"
"172.70.71"
"172.70.72"
"172.70.73"
"172.70.74"
"172.70.75"
"172.70.76"
"172.70.77"
"172.70.78"
"172.70.79"
"172.70.80"
"172.70.81"
"172.70.82"
"172.70.83"
"172.70.84"
"172.70.85"
"172.70.86"
"172.70.87"
"172.70.88"
"172.70.89"
"172.70.90"
"172.70.91"
"172.70.92"
"172.70.93"
"172.70.100"
"172.70.101"
"172.70.103"
"172.70.104"
"172.70.105"
"172.70.107"
"172.70.109"
"172.70.110"
"172.70.111"
"172.70.113"
"172.70.114"
"172.70.115"
"172.70.116"
"172.70.117"
"172.70.120"
"172.70.121"
"172.70.122"
"172.70.123"
"172.70.124"
"172.70.125"
"172.70.126"
"172.70.127"
"172.70.128"
"172.70.129"
"172.70.130"
"172.70.131"
"172.70.132"
"172.70.133"
"172.70.134"
"172.70.135"
"172.70.136"
"172.70.137"
"172.70.138"
"172.70.139"
"172.70.141"
"172.70.142"
"172.70.143"
"172.70.145"
"172.70.146"
"172.70.147"
"172.70.148"
"172.70.149"
"172.70.150"
"172.70.152"
"172.70.153"
"172.70.154"
"172.70.155"
"172.70.156"
"172.70.157"
"172.70.158"
"172.70.159"
"172.70.160"
"172.70.161"
"172.70.162"
"172.70.163"
"172.70.172"
"172.70.173"
"172.70.174"
"172.70.175"
"172.70.177"
"172.70.178"
"172.70.179"
"172.70.180"
"172.70.181"
"172.70.182"
"172.70.183"
"172.70.184"
"172.70.185"
"172.70.186"
"172.70.187"
"172.70.188"
"172.70.189"
"172.70.190"
"172.70.191"
"172.70.192"
"172.70.193"
"172.70.194"
"172.70.195"
"172.70.196"
"172.70.197"
"172.70.198"
"172.70.199"
"172.70.200"
"172.70.201"
"172.70.202"
"172.70.203"
"172.70.205"
"172.70.206"
"172.70.207"
"172.70.209"
"172.70.210"
"172.70.211"
"172.70.213"
"172.70.214"
"172.70.215"
"172.70.216"
"172.70.217"
"172.70.218"
"172.70.219"
"172.70.220"
"172.70.221"
"172.70.222"
"172.70.223"
"172.70.224"
"172.70.225"
"172.70.226"
"172.70.227"
"172.70.229"
"172.70.230"
"172.70.231"
"172.70.232"
"172.70.233"
"172.70.234"
"172.70.235"
"172.70.236"
"172.70.237"
"172.70.238"
"172.70.239"
"172.70.241"
"172.70.242"
"172.70.243"
"172.70.245"
"172.70.246"
"172.70.247"
"172.70.249"
"172.70.250"
"172.70.251"
"172.70.252"
"172.70.253"
"172.70.254"
"172.70.255"
"172.70.96"
"172.70.97"
"172.70.98"
"172.70.99"
"172.71.0"
"172.71.1"
"172.71.2"
"172.71.3"
"172.71.5"
"172.71.6"
"172.71.7"
"172.71.9"
"172.71.10"
"172.71.11"
"172.71.12"
"172.71.13"
"172.71.14"
"172.71.17"
"172.71.18"
"172.71.19"
"172.71.20"
"172.71.21"
"172.71.22"
"172.71.23"
"172.71.26"
"172.71.27"
"172.71.28"
"172.71.29"
"172.71.30"
"172.71.31"
"172.71.32"
"172.71.33"
"172.71.34"
"172.71.35"
"172.71.36"
"172.71.37"
"172.71.38"
"172.71.39"
"172.71.40"
"172.71.41"
"172.71.42"
"172.71.43"
"172.71.44"
"172.71.45"
"172.71.46"
"172.71.47"
"172.71.48"
"172.71.49"
"172.71.50"
"172.71.51"
"172.71.52"
"172.71.53"
"172.71.54"
"172.71.55"
"172.71.56"
"172.71.57"
"172.71.58"
"172.71.59"
"172.71.60"
"172.71.61"
"172.71.62"
"172.71.63"
"172.71.80"
"172.71.81"
"172.71.82"
"172.71.83"
"172.71.84"
"172.71.85"
"172.71.86"
"172.71.87"
"172.71.88"
"172.71.89"
"172.71.90"
"172.71.91"
"172.71.93"
"172.71.94"
"172.71.95"
"172.71.97"
"172.71.98"
"172.71.99"
"172.71.101"
"172.71.102"
"172.71.103"
"172.71.108"
"172.71.109"
"172.71.110"
"172.71.111"
"172.71.112"
"172.71.113"
"172.71.114"
"172.71.115"
"172.71.116"
"172.71.117"
"172.71.118"
"172.71.119"
"172.71.120"
"172.71.121"
"172.71.122"
"172.71.123"
"172.71.124"
"172.71.125"
"172.71.126"
"172.71.127"
"172.71.129"
"172.71.130"
"172.71.131"
"172.71.133"
"172.71.134"
"172.71.135"
"172.71.136"
"172.71.137"
"172.71.138"
"172.71.139"
"172.71.141"
"172.71.142"
"172.71.143"
"172.71.145"
"172.71.146"
"172.71.147"
"172.71.149"
"172.71.150"
"172.71.151"
"172.71.152"
"172.71.153"
"172.71.154"
"172.71.155"
"172.71.156"
"172.71.157"
"172.71.158"
"172.71.159"
"172.71.160"
"172.71.161"
"172.71.162"
"172.71.163"
"172.71.165"
"172.71.166"
"172.71.167"
"172.71.169"
"172.71.170"
"172.71.171"
"172.71.173"
"172.71.174"
"172.71.175"
"172.71.181"
"172.71.182"
"172.71.183"
"172.71.184"
"172.71.185"
"172.71.186"
"172.71.187"
"172.71.188"
"172.71.189"
"172.71.190"
"172.71.191"
"172.71.192"
"172.71.193"
"172.71.194"
"172.71.195"
"172.71.196"
"172.71.197"
"172.71.198"
"172.71.199"
"172.71.200"
"172.71.201"
"172.71.202"
"172.71.203"
"172.71.204"
"172.71.209"
"172.71.210"
"172.71.211"
"172.71.213"
"172.71.214"
"172.71.215"
"172.71.217"
"172.71.218"
"172.71.219"
"172.71.220"
"172.71.221"
"172.71.222"
"172.71.223"
"172.71.224"
"172.71.225"
"172.71.226"
"172.71.227"
"172.71.228"
"172.71.229"
"172.71.230"
"172.71.231"
"172.71.232"
"172.71.233"
"172.71.234"
"172.71.235"
"172.71.236"
"172.71.237"
"172.71.238"
"172.71.239"
"172.71.245"
"172.71.246"
"172.71.247"
"172.71.249"
"172.71.250"
"172.71.251"
"172.71.252"
"172.71.253"
"172.71.254"
"172.71.255"
"173.245.54"
"173.245.60"
"173.245.61"
"173.245.63"
"188.114.100"
"188.114.102"
"188.114.103"
"188.114.106"
"188.114.107"
"188.114.108"
"188.114.111"
"197.234.240"
"197.234.241"
"197.234.242"
"197.234.243"
"198.41.136"
"198.41.138"
"198.41.240"
"198.41.241"
"198.41.242"
"198.41.224"
"198.41.226"
"198.41.228"
"198.41.229"
"198.41.230"
"198.41.231"
"198.41.232"
"198.41.233"
"198.41.236"
"198.41.238"
"198.41.239"
"198.41.251"
"198.41.253"
"199.27.132"
)

# A wide range of commonly used and relevant ports for Cloudflare, WARP, VPN, and bypassing restrictions
ports=(
  443 2408 53 8080 8443 2053 2096 2083 2087 2052 2082 2086 500 3306 143 993 995 587 2525
  6666 8444 2080 5060 1194 123 8880 8883 8448 5222 5228 3478 1935 10000 65432 854 939 2408 1074
)

max_jobs=64         # Maximum parallel jobs (tune for your hardware)
max_ping=60         # Max ping for stage 1 (ms)
ip_count=6          # Number of top IPs to scan ports on

# ------------------------ STAGE 1: IP LATENCY SCAN ----------------------

tmpfile1=$(mktemp)
total_ips=$((${#ranges[@]} * 256))
tested=0

progress_bar() {
  percent=$(( 100 * $1 / $2 ))
  bar_size=40
  filled=$(( bar_size * $1 / $2 ))
  empty=$(( bar_size - filled ))
  bar=$(printf "%0.s#" $(seq 1 $filled))
  spaces=$(printf "%0.s-" $(seq 1 $empty))
  printf "\rProgress: [%s%s] %d%% (%d/%d)" "$bar" "$spaces" "$percent" "$1" "$2"
}

ping_ip() {
  ip="$1"
  ping_time=$(ping -c 1 -W 1 "$ip" 2>/dev/null | grep 'time=' | awk -F'time=' '{print $2}' | awk '{print $1}')
  if [[ -n "$ping_time" ]]; then
    ping_int=${ping_time%.*}
    if (( ping_int <= max_ping )); then
      echo "$ip $ping_int" >> "$tmpfile1"
    fi
  fi
}

export -f ping_ip
export tmpfile1
export max_ping

for range in "${ranges[@]}"; do
  for i in $(seq 0 255); do
    ip="$range.$i"
    ping_ip "$ip" &
    ((tested++))
    if (( tested % 50 == 0 || tested == total_ips )); then
      progress_bar "$tested" "$total_ips"
    fi
    while (( $(jobs -r | wc -l) >= max_jobs )); do
      sleep 0.01
    done
  done
done

wait
progress_bar "$total_ips" "$total_ips"
echo

# Select the top N fastest IPs
if [[ -s "$tmpfile1" ]]; then
  mapfile -t best_ips < <(sort -k2 -n "$tmpfile1" | head -n${ip_count} | awk '{print $1}')
else
  echo "No fast endpoint found."
  rm -f "$tmpfile1"
  exit 1
fi

# ---------------- STAGE 2: PORT SCAN ON TOP IPs -------------------------

tmpfile2=$(mktemp)
total_tests=$((${#best_ips[@]} * ${#ports[@]}))
tested=0

echo -e "\nScanning a wide range of ports on the top $ip_count endpoints..."

# Check if TCP port is open (fast & silent)
port_open() {
  ip="$1"
  port="$2"
  timeout 0.7 bash -c "</dev/tcp/$ip/$port" 2>/dev/null
}

# If port is open, log it with ping
ping_to_port() {
  ip="$1"
  port="$2"
  if port_open "$ip" "$port" ; then
    ping_time=$(ping -c 1 -W 1 "$ip" 2>/dev/null | grep 'time=' | awk -F'time=' '{print $2}' | awk '{print $1}')
    if [[ -n "$ping_time" ]]; then
      ping_int=${ping_time%.*}
      echo "$ip $port $ping_int" >> "$tmpfile2"
    fi
  fi
}

export -f port_open
export -f ping_to_port
export tmpfile2

for ip in "${best_ips[@]}"; do
  for port in "${ports[@]}"; do
    ping_to_port "$ip" "$port" &
    ((tested++))
    if (( tested % 10 == 0 || tested == total_tests )); then
      progress_bar "$tested" "$total_tests"
    fi
    while (( $(jobs -r | wc -l) >= max_jobs )); do
      sleep 0.01
    done
  done
done

wait
progress_bar "$total_tests" "$total_tests"
echo

# Show best open port (lowest ping) for each IP
echo -e "\nBest Cloudflare WARP Endpoints and Open Ports (from the fastest $ip_count IPs):"
if [[ -s "$tmpfile2" ]]; then
  awk '{print $1}' "$tmpfile2" | sort -u | while read ip; do
    grep "^$ip " "$tmpfile2" | sort -k3 -n | head -n1
  done | sort -k3 -n | head -n$ip_count | awk '{printf "%-15s %-6s %sms\n", $1, $2, $3}'
else
  echo "No open port found on the top $ip_count endpoints."
fi

rm -f "$tmpfile1" "$tmpfile2"